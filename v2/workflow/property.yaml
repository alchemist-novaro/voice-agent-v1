note: Property Information
nodes:
  init:
    type: analyze
    client:
      prompt: |
        Analyze chat history and determine following data:
        ```json
        {
          "authorized": boolean | null
        }
        ```

        If customer is owner or person responsible for paying for repairs, the authorized should be true.
        If not authorized should be false
        If can't find property authorized info, so can't sure customer is property authorized person or not, authorized should be null

        Important:
        If in chat history, if property authorized person is not mentioned, the authorized should be null.
        Only if property authorized person is mentioned clearly and confirmed, the authorized should be true or false.

        Output only json code. Any explanations or plaintext are not allowed.
      return: property_authorized
    go_to:
      data: property_authorized
      cases:
        - name: authorized
          value: true
          to: property
          step: finish_agent
        - name: authorized
          value: null
          to: property
          step: ask_authorized
        - name: authorized
          value: false
          to: extra
          step: handle_cancel
      default:
        to: property
        step: ask_authorized
  ask_authorized:
    type: process
    client:
      prompt: |
        Base text
        """
        Sorry but we can't sure you are property authorized person or not. Would you confirm if you are owner or person responsible for paying for [service]
        """

        Update base assistant message more friendly and reasonably.
        Output ONLY updated text. (no explanations, no extra text, no code format)
    go_to:
      data:
      cases: []
      default:
        finished: true
        to: intent
        step: init
  finish_agent:
    type: process
    client:
      prompt: |
        Base text:
        """
        Thanks for confirming you are property authorized person.
        """
        or 
        """
        Thank you for confirming you are owner.
        """
        or
        """
        Let can me know you are authorized person.
        """

        According to chat history, update base text more natively, and reasonably
        
        Output ONLY updated assistant message (no explanations, no extra text, no code format)
    go_to:
      data:
      cases: []
      default:
        to: property
        step: save_agent_finished_state
  save_agent_finished_state:
    type: callback
    client:
      name: finish_property_agent
      args: []
      return:
    go_to:
      data:
      cases: []
      default:
        to: property
        step: go_to_other_agent
  go_to_other_agent:
    type: callback
    client:
      name: get_customer_status
      args: []
      return: customer_status
    go_to:
      data: customer_status
      cases:
        - name: greeting
          value: false
          to: greeting
          step: fetch_contact_information
        - name: service_address
          value: false
          to: greeting
          step: go_to_addresses
        - name: service_information
          value: false
          to: service
          step: collect_services
        - name: dispatch
          value: false
          to: dispatch
          step: collect_available_times
      default:
        to: extra
        step: handle_success