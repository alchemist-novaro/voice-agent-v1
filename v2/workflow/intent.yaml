note: Classify Intents
nodes:
  init:
    type: analyze
    client:
      prompt: |
        Output intent data as json format with following schema based on chat history:
        ```json
        {
          "intent": string,    // intent of current message (greeting | service_address | service_information | property | dispatch | other)
        }
        ```
  
        The intent details are as following (Analyze chat history and determine):
        1. Greeting & Initial Customer Identification (intent: greeting | service_address)
          Detail:
          - First Message Greeting  (greeting)
            ONLY if this is your FIRST message in the conversation:
            "Welcome to Acme! I'm Uno, your digital assistant." + [Continue naturally based on customer's request and conversation context]
          - Customer Contact Information  (greeting)
            Customer contact information (full_name, phone_number, email) asking and responding or confirming
          - Server Addresses (service_address)
            Asking requested service address and answering or confirming
        2. Service Information (intent: service_information)
          Detail:
            - Qualification question asking and answer
            - Ask about Dequalification 
        3. Property Information (intent: property)
          Detail:
            Ask and answer qualify property autherized person related topic
        4. Availability & Dispatch Fee (intent: dispatch)
          Detail:
            Provide availability based on the customer's needs, along with the relevant dispatch fees.
            - Query the availability
            - Present the first available appointment to the customer
            - Offer exactly ONE alternative appointment time to the customer.
            - Inform the customer that you couldn't find an available date, propose to redirect the customer to an authorized person
            - Set the selected availability
        5. Other (intent: other)
          Detail:
            All the intents are not related above 4 intents.
            It can be joking, humor, or any other topics.

        Important:
        If customer send first help message (e.g. Hi, my AC stopped working.), classify intent as greeting.
  
        # Important:
        Output only json code. Any plaintext or explanations are not allowed.
      return: intent_data
    go_to:
      data: intent_data
      cases:
        - name: intent
          value: greeting
          to: greeting
          step: init
        - name: intent
          value: service_address
          to: greeting
          step: go_to_addresses
        # - name: intent
        #   value: service_information
        #   to: service
        #   step: init
        - name: intent
          value: property
          to: property
          step: init
        - name: intent
          value: dispatch
          to: dispatch
          step: init
      default:
        to: intent
        step: no_topic
  no_topic:
    type: process
    client:
      prompt: |
        The customer's message is unrelated to the current conversation intent.

        Customer message: $message

        Your goals:
        1. Respond naturally to the customer's request/question very shortly.
        2. Politely point out that their message is off-topic.
        3. Guide the customer back to the current conversation intent.

        Output: ONLY the updated assistant message (no explanations, no extra text).
    go_to:
      data: 
      cases: []
      default:
        finished: true
        to: intent
        step: init